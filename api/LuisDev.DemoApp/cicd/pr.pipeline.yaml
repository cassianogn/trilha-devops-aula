trigger: none # não roda em push
pr:
  branches:
    include:
      - tests # PRs cujo ALVO é 'tests'
  paths:
    include:
      - api/LuisDev.DemoApp/**

variables:
  DOTNET_VERSION: "6.0.x"
  BUILD_CONFIG: "Release"
  SOLUTION: "./api/LuisDev.DemoApp/LuisDev.DemoApp.sln"
  TEST_PROJECTS: "./api/LuisDev.DemoApp/LuisDev.DemoApp.Tests/LuisDev.DemoApp.Tests.csproj"
  WARN_AS_ERROR: "true"

pool:
  vmImage: "ubuntu-latest"

steps:
   - checkout: self

   - task: UseDotNet@2
     displayName: "Use .NET SDK $(DOTNET_VERSION)"
     inputs:
       packageType: 'sdk'
       version: '$(DOTNET_VERSION)'
 
   - task: DotNetCoreCLI@2
     displayName: "Restore"
     inputs:
       command: 'restore'
       projects: '$(SOLUTION)'
 
   - task: DotNetCoreCLI@2
     displayName: "Build"
     inputs:
       command: 'build'
       projects: '$(SOLUTION)'
       arguments: '--configuration $(BUILD_CONFIG) --no-restore'
 
   - task: DotNetCoreCLI@2
     displayName: "Test"
     inputs:
       command: 'test'
       projects: '$(TEST_PROJECTS)'
       arguments: '--configuration $(BUILD_CONFIG) --logger trx'
       publishTestResults: true    # publica os TRX na aba "Tests"